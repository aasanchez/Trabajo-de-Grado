\chapter{Sistema de visión por computadora para microensamble}
\label{cap:SVCME}
Este capítulo describe el sistema de visión por computadora para microensamble propuesto. Dicho sistema forma parte importante de la microfábrica en desarrollo en el laboratorio de investigación del autor. En el capítulo anterior se expuso la necesidad de que dicho sistema de visión sea desarrollado como parte de las investigaciones sobre microfábricas. Se explicó por qué un sistema de este tipo debe de estar basado en visión por computadora. El presente trabajo tiene como objetivo fundamental desarrollar el sistema automático de visión por computadora de reconocimiento de piezas para una microfábrica. Para explicar lo anterior, la siguiente Sección (\ref{sec:LMM}) introduce el laboratorio donde se ha desarrollado este trabajo dando cuenta de sus objetivos y líneas de investigación. En la Sección \ref{sec:SAMP} se explica a detalle el sistema de manejo de piezas propuesto y su función dentro de la microfábrica en desarrollo. Por último, en la Sección \ref{sec:SVT} se describe el sistema de visión técnica para reconocimiento y localización de piezas que se propone.

\section{Investigación en el Laboratorio de Micromecánica y Mecatrónica}\label{sec:LMM}
Desde 1998, el Laboratorio de Micromecánica y Mecatrónica (LMM) del Centro de Ciencias Aplicadas y Desarrollo Tecnológico (CCADET) de la Universidad Nacional Autónoma de México (UNAM), encabezado por el Dr. Ernst Kussul, trabaja en el desarrollo de microfábricas y las tecnologías relacionadas. Diversos artículos especializados dan cuenta de la producción y los resultados alcanzados \citep{Rachkovskij2001,Baidyk2002,Kussul2002JMM,Kussul2002SMHS,Gengis2006,Lara-Rosano}. El LMM desde su constitución y hasta el momento ha tenido diversas líneas de investigación. Las principales son las siguientes:

\begin{itemize}
\item Desarrollo de microtecnología mecánica para aplicaciones en células de producción.
\item Investigación y desarrollo de sistemas de control para micromáquinas herramientas y micromanipuladores.
\item Investigación de sistemas de control basados en redes neuronales con aplicaciones en sistemas micromecánicos.
\item Investigación y desarrollo de un sistema de visión computacional para microequipo.
\item Investigación y desarrollo de manipuladores de baja inercia.
\end{itemize}

Las bases de estas investigaciones y desarrollos fueron planteadas en \citep{Kussul1996JMM}. La propuesta general se denomina Tecnología de Microequipo o MET (por sus siglas en inglés). Esta propuesta se ha introducido en la Sección \ref{sec:MET} y se ha hecho de acuerdo a lo expuesto en \citep{Kussul1993}. Mediante el uso de generaciones sucesivas de microequipo capaz de reproducirse así mismo, pero con dimensiones más pequeñas, se puede llegar en pocas generaciones a equipo de dimensiones micrométricas partiendo de equipo miniatura de unos cuantos centímetros de tamaño, véase Tabla \ref{t:generacionesMET}.

\begin{table*}[htb]
\caption{Generaciones de microequipo de acuerdo a su escala de reducción.}
\label{t:generacionesMET}\centering
\par
\begin{tabular}{|c||r|r|r|}
\hline
& \multicolumn{3}{|l|}{Escala de reducción (ER)} \\ \hline
Generación & ER=2 & ER=4 & ER=8       \\ \hline \hline
1           & $^*$100 mm & $^*$100 mm & $^*$100 mm \\ \hline
2           & 50 mm & 25 mm & 12.5 mm \\ \hline
3           & 25 mm & 6.25 mm & 1.5 mm \\ \hline
4           & 12.5 mm & 1.5 mm & 0.2 mm \\ \hline
5           & 6 mm & 0.4 mm & 25 $\mu$m \\ \hline
6           & 3 mm & 0.1 mm & 3 $\mu$m \\ \hline
7           & 1.5 mm & 25 $\mu$m & $\triangle$ \\ \hline
8           & 0.8 mm & 6 $\mu$m & --- \\ \hline
9           & 0.4 mm & 1.5 $\mu$m & --- \\ \hline
10          & 0.2 mm & $\triangle$ & --- \\ \hline             
\multicolumn{4}{|l|}{\small{$^*$ Valor inicial igual para todos los casos.}} \\ \hline
\multicolumn{4}{|l|}{\small{$\triangle$ Límite teórico de micromaquinado.}} \\ \hline
\end{tabular}
\end{table*}

Además del objetivo principal de crear otra generación más pequeña para cada una de las generaciones MET, existen muchas otras aplicaciones diversas. Estas aplicaciones tienen que ver con la posibilidad de producción de piezas y equipos diversos de dimensiones correspondientes a cada generación MET. 

Las principales áreas tecnológicas de aplicación son la medicina, la microelectrónica y la industria espacial. Las posibilidades son muy alentadoras ya que no sólo se tendrá la capacidad de producir piezas y equipos de dimensiones micrométricas, sino de cualquier dimensión intermedia entre lo micro y lo meso.

Sin embargo, para crear la primera generación MET existen diversos problemas de ingeniería que es necesario resolver. A medida que nuevas generaciones sean creadas nuevos problemas asociados a sus dimensiones deberán enfrentarse debido a la miniaturización progresiva. Con el objetivo general de desarrollar el microequipo en el LMM se llevan a cabo diversas investigaciones. Estas investigaciones tienen que ver con diseño mecánico, precisión mecánica, ingeniería térmica, resistencia de materiales, interfaces, sistemas mecatrónicos e inteligencia artificial entre otros. Todas estas investigaciones son necesarias para alcanzar los objetivos mencionados para el LMM.

Como avance concreto en el objetivo general del LMM se ha desarrollado y caracterizado un microcentro de maquinado con dimensiones de $130\times160\times85mm^{3}$. Este centro de maquinado ha permitido manufacturar objetos de entre $50\mu m$ y $5mm$. Estas piezas tienen geometrías tridimensionales complejas, como es el caso de tornillos, engranes y ejes graduados que han sido producidos. Estas piezas producidas son de materiales diversos como acero, plásticos varios o latón \citep{Kussul2002SMHS}. Adicionalmente se han diseñado y construido otros prototipos de la primera generación MET como es el caso de un par de manipuladores. El centro de maquinado y los manipuladores se muestran en la Figura \ref{F:LMM-METmachines}.

\begin{figure}
[h]
\begin{center}
\includegraphics[
%natheight=1.030900in,
%natwidth=4.614600in,
%height=3in
width=5in
]%
{figuras/METmachinesFromLMM.jpg}%
\caption[Máquinas de la primera generación MET.]{Máquinas de la primera generación MET. Izquierda, microcentro de maquinado. Centro, manipulador de topología común. Derecha, manipulador basado en paralelogramos. Un disco magnético de $3 \frac{1}{4}$'' se ubica en la imagen para dar cuenta de las dimensiones.}%
\label{F:LMM-METmachines}%
\end{center}
\end{figure}

Los conceptos MET y microfábrica están ampliamente relacionadas en la perspectiva del LMM ya que la viabilidad de esta tecnología depende de la capacidad de construir una microfábrica altamente automatizada de primera generación. Esta microfábrica deberá ser capaz de producir las piezas y luego las máquinas de una siguiente generación más pequeña como se expuso en la Sec. \ref{sec:MET}. Con el objetivo de lograr la automatización y la flexibilidad de la microfábrica se ha argumentado que una función muy importante es la de un sistema automático de manejo de piezas (Sec. \ref{sec:VCuF}). En la siguiente sección se expone la propuesta de dicho sistema enmarcando sobre éste los objetivos del presente trabajo.

\section{Sistema automático de manejo de piezas}
\label{sec:SAMP}
En una fábrica convencional los materiales y las piezas producidas pertenecen a un proceso masivo. Por lo general este proceso es poco o nada flexible durante el tiempo de producción. Esta forma de trabajo genera gran cantidad de productos de un mismo tipo siendo la forma dominante en el mundo desarrollado al día de hoy. El concepto de microfábrica no es solamente una fábrica de tamaño reducido, sino un nuevo concepto de producción \citep{Okazaki2004}. En el concepto de producción de la microfábrica se busca hacer de la producción algo flexible. Lo anterior significa que los productos pueden variar en diseños y geometrías entre muchos otros aspectos en un mismo lote de producción. Lo anterior hace que el material suministrado así como los productos intermedios y terminados del proceso no sean fácilmente manejables mediante equipos rígidos especialmente adaptados a un sólo producto. Es por ello que un sistema automático de manejo de materiales y piezas debe ser desarrollado para la microfábrica. Independientemente de ello, un sistema así podrá ser utilizado además en las fábricas convencionales. 

Diversas operaciones de una microfábrica requieren un sistema automático de manejo de materiales y piezas, entre las que sobresalen:
\begin{itemize}
\item El suministro y manejo de materia prima de estado sólido.
\item La manipulación de los productos intermedios y finales.
\item La manipulación de piezas y partes para el microensamble.
\item El remplazo y cambio de herramientas.
\item La manipulación y reemplazo de partes para labores de mantenimiento.
\end{itemize}

Dada la amplia variedad de materiales y objetos a ser manejados y a las funciones requeridas, un sistema de tales características deberá ser altamente flexible y deberá contar con algunas capacidades atribuibles a la inteligencia, como es el caso de la identificación de texturas para diferenciar el material o la determinación de la posición de ciertos objetos aleatoriamente ordenados con miras en su manipulación.

El problema descrito se aborda en el presente trabajo proponiendo un sistema automático de manejo de piezas enfocado a la tarea de reconocimiento de piezas aleatoriamente distribuidas. Un sistema capaz de resolver esta compleja tarea será fundamental para el desarrollo de los diversos sistemas de manipulación de materiales y partes para una microfábrica.

La meta de un sistema automático de manejo de piezas es que sea capaz de reconocer una determinada pieza aleatoriamente ubicada en una cierta área de trabajo además de su posición y orientación respectiva, de tal forma que pueda ser tomada con un manipulador para ser movida a alguna otra posición en el espacio según los requerimientos del proceso respectivo. Un sistema que cumpla con las expectativas mencionadas debe ser flexible, es decir, debe ser capaz de manejar piezas de diversas formas y con múltiples dimensiones.

Como solución al problema planteado en el presente trabajo se tiene un Sistema Automático de Manipulación de Piezas (SAMP). Este sistema se ha propuesta para formar parte en una celda de ensamble en una microfábrica. El sistema propuesto se muestra en la Figura \ref{fig:piecesmanipautomaticsystem}. El SAMP está compuesto por dos cámaras, un manipulador, un sistema de control del manipulador (SCM), un sistema inteligente de manipulación (SIM) y un sistema de visión técnica (SVT).

\begin{figure}
[h]
\begin{center}
\includegraphics[
%natheight=1.030900in,
%natwidth=4.614600in,
%height=3.6832in,
width=4.0in
]%
{figuras/SistemaAutomDeManipulABloquesV2.png}%
\caption{Sistema automático de manejo de piezas.}%
\label{fig:piecesmanipautomaticsystem}%
\end{center}
\end{figure}

En congruencia con la MET, el diseño del SAMP utiliza componentes de bajo costo y de manufactura simple. La parte mecánica del sistema es el manipulador, el cuál debe ser diseñado con MET para permitir su consecuente decremento en dimensión, un diseño se ha propuesto en \citep{Kussul2002JMM}. Las dos cámaras del diseño son cámaras \emph{web} de bajo costo y baja resolución. Para la segunda y siguientes generaciones MET, estas cámaras deberán emplear lentes para reducir su área de enfoque sin deteriorar la calidad de imagen. El resto de los componentes, los tres subsistemas propuestos, son sistemas lógicos implementados mediante software y hardware. Estos subsistemas no requieren ser escalados en las sucesivas generaciones MET.

Cada uno de los tres subsistemas del SAMP tiene una función específica. El SIM es el control central del sistema de manipulación. Es el encargado de comunicarse con el exterior para recibir tareas y devolver información del estado de éstas así como del estado general del SAMP, también intercomunica los otros dos subsistemas. El SCM es la parte lógica del manipulador, es el responsable de convertir los requerimientos dados para el SIM en términos de coordenadas espaciales a el espacio de estados de la topología particular del manipulador así como realizar la planeación de trayectorias de éste. Convirtiendo los requerimientos en señales eléctricas para mover los actuadores del manipulador. El SCM también devuelve el estado del manipulador, tanto espacial (posición, orientación y estado del efector) como lógica (banderas de error, de éxito u otros estados). El SVT es la parte inteligente del SAMP, es el responsable de devolver una posición espacial ante el requerimiento de localizar cierto tipo de pieza en el área de trabajo. Esto es, dada la necesidad de manipular una o más piezas, el SIM pide al SVT buscar éstas en el área de trabajo y devolver la posición de cada una de ellas para que éstas puedan ser requeridas físicamente al manipulador mediante el SCM. El usuario del SAMP puede ser un humano u otro sistema, e.g. sistema de manufactura o centro de control de la microfábrica.


Existen dos tareas comunes a ser resueltas por el SAMP. Una es colocar un cierto tipo de pieza ubicada en el área de trabajo en una micromáquina herramienta, la otra tarea es realizar un ensamble sencillo utilizando dos piezas del área de trabajo. Para la primera tarea el SIM pedirá al SVT localizar la pieza solicitada, en caso de que exista alguna de estas piezas en el área de trabajo, el SVT deberá devolver al SIM la ubicación espacial de la misma. El SIM enviará entonces esta posición y orientación al SCM junto con los datos de destino para la pieza. La posición destino puede ser conocida por el SIM o no, según ésta sea de una máquina previamente ubicada o no. La segunda tarea es más complicada ya que requiere que el manipulador tenga capacidad para ensamble, y de no conocerse la geometría exacta de las piezas a ensamblar, se requerirá de un sistema de visión por computadora basado en la propuesta dada en \citep{Baidyk2004}. Esta segunda tarea requerirá además que la tarea particular de ensamble este previamente programada de modo que el manipulador pueda colocar la primera pieza en la posición y lugar correctos para posteriormente ensamblarle la segunda pieza. Una vez que se logre desarrollar un sistema capaz de realizar la segunda tarea, nada impide que éste pueda realizar ensambles con más piezas.

Dadas las características y requerimientos funcionales de cada uno de los sistemas que componen el SMAP, en el presente trabajo se ha desarrollado el SVT, ya que es el sistema que propone más retos y mayor dificultad, además de constituir una tarea que no está resuelta satisfactoriamente según se revisó en la Sección \ref{sec:EdA}.

Dados los grandes retos que presenta este sistema, para realizar las investigaciones orientadas al desarrollo del SVT se procuró aislar el problema de los demás subsistemas y componentes del SAMP sin perder la problemática fundamental que se presenta. Por esto, el trabajo se hace sobre la parte del SAMP que contiene el SVT y una sola cámara además de su área de trabajo. Es decir, este trabajo está basado en la tarea de reconocimiento de piezas y sus posiciones en ambiente de microfábricas. En la siguiente sección final de este capítulo se aborda en detalle el SVT.


\section{Subsistema de visión técnica (SVT)}
\label{sec:SVT}
En las Secciones \ref{sec:RPmF} y \ref{sec:RPPmF} se han descrito los requerimientos generales para el Sistema de Visión Técnica (SVT) para una microfábrica. Se tiene que un SVT para localización de piezas debe ser congruente con los principios de flexibilidad de una microfábrica. Para lo cual debe ser capaz de trabajar con diversos tipos de piezas, además adaptarse a nuevas piezas en poco tiempo por lo que debe minimizarse el tiempo de procesamiento previo requerido para el reconocimiento de nuevas piezas.

Como se explicó en la sección anterior, el propósito del SVT es reconocer objetos y la posición de éstos. Este sistema está compuesto de tres elementos además de la cámara. Estos elementos son una interfase, un localizador de objetos y un controlador para la cámara (véase Fig. \ref{technicalvisionsubsystem}). La Interfase es la unidad que se comunica con el exterior, el SAMP (Véase Fig. \ref{fig:piecesmanipautomaticsystem}) además de intercomunicarse con los otros dos elementos del sistema. A través de la Interfase el SVT recibe ordenes y envía información. El localizador de objetos es el elemento principal del SVT, su función es identificar y localizar un objeto requerido en el campo de visión de la cámara, devolviendo sus coordenadas. El controlador de la cámara se encarga de capturar imágenes del área de trabajo cuándo así lo requiera el localizador de objetos.

\begin{figure}
[h]
\begin{center}
\includegraphics[
%natheight=1.030900in,
%natwidth=4.614600in,
%height=3.6832in,
width=2.5in
]%
{figuras/SVT.png}%
\caption{Sistema de Visión Técnica.}%
\label{technicalvisionsubsystem}%
\end{center}
\end{figure}

El objetivo es encontrar las coordenadas de las piezas con una precisión aceptable para su posterior manipulación. Esta tarea debe ser eficiente en cuanto al uso del tiempo y el uso de recursos (equipo, memoria y tiempo de procesador, etc.), de tal manera que el sistema pueda ser utilizado en línea de producción (\emph{on-line}) además de ser económico. En la Fig. \ref{foundworkpiecewithcoordinates} se muestra el resultado esperado por el SVT ante la solicitud de localizar un tornillo dentro del área de trabajo. Se busca que el SVT localice el primer objeto del tipo requerido y devuelva su posición y su orientación. Lo ideal es que esto se haga respecto al centro de gravedad de la pieza. La posición y orientación deben tener precisión tal, de forma que permitan la manipulación de la pieza mediante un robot.

\begin{figure}
[h]
\begin{center}
\includegraphics[
%natheight=1.030900in,
%natwidth=4.614600in,
%height=3.6832in,
width=1.8in
]%
{figuras/piezaEncontradaConCoordenadas.png}%
\caption[Esquema de localización de una pieza reconocida.]{Ejemplo de un tornillo reconocido. El sistema devuelve las coordenadas ($x,y,\protect\theta $) con respecto del origen de la imagen.}
\label{foundworkpiecewithcoordinates}%
\end{center}
\end{figure}

Para el desarrollo del SVT han sido hechas las siguientes consideraciones sobre las piezas a reconocer y a ubicar.
\begin{itemize}
\item Se encuentran en un área de trabajo igual al campo visual de la cámara.
\item Se localizan en un mismo plano\footnote{Esta consideración no es del todo cierta para una de las bases de datos utilizadas, ya que las piezas están amontonadas y por ende, en distintos planos; sin embargo, la distancia entre éstos es relativamente pequeña.}.
\item Están aleatoriamente distribuidas y orientadas.
\item Pueden estar juntas e incluso una sobre otra, este caso no es general pero fue considerado para los experimentos.
\item Tienen sección transversal predominantemente redonda, plana o una combinación de ambas características (en un caso), esto facilita la tarea de reconocimiento ya que piezas así dan por lo común una vista superior igual sin importar su rotación respecto de su eje principal. La vista superior es importante porque es la perspectiva de la cámara del SVT.
\end{itemize}

El SVT se probó con diversos conjuntos de piezas reales sin ningún tipo de tratamiento especial. Las piezas escogidas son predominantemente mecánicas las cuales se encuentran comúnmente en una línea de producción. Se utilizaron piezas tales como tornillos de diversas clases, tuercas, arandelas y otras piezas maquinadas. En la Fig. \ref{piezasUtilizadas} se muestran algunas de las piezas utilizadas. En congruencia con un ambiente de ensamble y producción, estas piezas en ocasiones presentan superficies sucias, tienen colores oscuros, brillo heterogéneo y a veces tienen sombras. Todas las anteriores son características que complican la tarea de reconocimiento.

\begin{figure}
[h]
\begin{center}
\includegraphics[
%natheight=1.030900in,
%natwidth=4.614600in,
%height=3.6832in,
width=2.5in
]%
{figuras/piezasUtilizadas.png}%
\caption[Diversas piezas utilizadas en el desarrollo del SVT.]{Algunas de las diversas piezas que se utilizaron en las investigaciones y experimentos al desarrollar el SVT.}%
\label{piezasUtilizadas}%
\end{center}
\end{figure}


El siguiente capítulo se dedica a la parte medular del SVT, que es el sistema de localización de piezas. Se describirán las bases de datos de imágenes utilizadas para la experimentación y se explicarán los métodos utilizados para la investigación y desarrollo del sistema identificador de piezas además de explicar el método particular de localización propuesto.

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "tesis"
%%% End: 

